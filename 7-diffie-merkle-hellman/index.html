<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Diffie Merkle Hellman!</title>

    <!-- START: our font: Nunito -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
        rel="stylesheet">
    <!-- END: our font: Nunito -->

    <!-- PostHog Integration Start -->
    <script>
        !function (t, e) { var o, n, p, r; e.__SV || (window.posthog = e, e._i = [], e.init = function (i, s, a) { function g(t, e) { var o = e.split("."); 2 == o.length && (t = t[o[0]], e = o[1]), t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } } (p = t.createElement("script")).type = "text/javascript", p.async = !0, p.src = s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") + "/static/array.js", (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r); var u = e; for (void 0 !== a ? u = e[a] = [] : a = "posthog", u.people = u.people || [], u.toString = function (t) { var e = "posthog"; return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e }, u.people.toString = function () { return u.toString(1) + ".people (stub)" }, o = "capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "), n = 0; n < o.length; n++)g(u, o[n]); e._i.push([i, s, a]) }, e.__SV = 1) }(document, window.posthog || []);
        posthog.init('phc_yHP5sNNdtvQqVh1IjhFKe30UMexVa7d5j3QzaHvRUqi', { api_host: 'https://us.i.posthog.com' })
    </script>
    <!-- PostHog Integration End -->

    <!-- sentry error monitoring start -->
    <script src="https://js.sentry-cdn.com/3a27f38f284bb38b1a83d2f74fdbe425.min.js" crossorigin="anonymous"></script>
    <!-- sentry error monitoring end -->


    <!-- Medium zoom! -->
    <script src="https://unpkg.com/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script>
    <script src="../scripts/medium-zoom.js"></script>

    <link rel="stylesheet" href="../styles/content.css">

    <style>
        .option {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .option:hover {
            background-color: var(--grey-color);
            color: var(--dark-black-color);
        }

        .option.in-progress {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--grey-color);
            color: var(--dark-black-color);
        }

        #result {
            margin-top: 1rem;
            margin-bottom: 2.5rem;
            font-weight: bold;
        }

        .progress {
            margin-top: 20px;
            width: 10px;
            height: 10px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid orange;
            border-radius: 50%;
            animation: spin 0.5s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <nav>
        <button id="all-lessons-btn" class="btn secondary-btn">
            <svg height="1.2em" style="margin-right: 2px; vertical-align: bottom;" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" fill="currentColor" class="size-6">
                <path
                    d="M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 1 .707A8.237 8.237 0 0 1 6 18.75c1.995 0 3.823.707 5.25 1.886V4.533ZM12.75 20.636A8.214 8.214 0 0 1 18 18.75c.966 0 1.89.166 2.75.47a.75.75 0 0 0 1-.708V4.262a.75.75 0 0 0-.5-.707A9.735 9.735 0 0 0 18 3a9.707 9.707 0 0 0-5.25 1.533v16.103Z" />
            </svg>
            Curriculum
        </button>

        <div id="all-lessons-drawer">
            <h2>
                Curriculum
                <button id="drawer-close-btn">&times;</button>
            </h2>

            <div class="module">

                <p>Module 1</p>

                <ul>
                    <li>
                        <a href="../0-before-we-start">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Before we start
                            </span>
                        </a>
                    </li>

                    <li>
                        <a href="../1-symmetric-key-encryption">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Symmetric key encryption
                            </span>
                        </a>
                    </li>


                    <li>
                        <a href="../2-caesar-challenge">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Challenge: Caesar's cipher
                            </span>
                        </a>
                    </li>



                    <li>
                        <a href="../3-the-hash">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Cryptographic hash function
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="../4-revealed-passwords">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Password hashing
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="../5-rainbows-and-salts">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Rainbow tables and the salt
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="../6-slow-them-down">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                PBKDF-2
                            </span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="module">
                <p>Module 2</p>

                <ul>
                    <li class="current-lesson">
                        <a href="../7-diffie-merkle-hellman">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                Diffie-Hellman-Merkle key exchange
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="../8-rsa">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                RSA
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="../9-tls">
                            <svg height="20px" style="vertical-align: middle;" fill="none" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg" stroke="currentColor">

                                <g id="SVGRepo_bgCarrier" stroke-width="0" />

                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />

                                <g id="SVGRepo_iconCarrier">
                                    <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                            </svg>
                            <span>
                                TLS
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <script src="../scripts/lesson-drawer.js"></script>


        <a class="underline-style svg-there" href="../8-rsa">
            <span>Next lesson</span>

            <svg style="padding-left: 2px; vertical-align: middle;" height="1.2em" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24" fill="currentColor" class="size-6">
                <path
                    d="M5.055 7.06C3.805 6.347 2.25 7.25 2.25 8.69v8.122c0 1.44 1.555 2.343 2.805 1.628L12 14.471v2.34c0 1.44 1.555 2.343 2.805 1.628l7.108-4.061c1.26-.72 1.26-2.536 0-3.256l-7.108-4.061C13.555 6.346 12 7.249 12 8.689v2.34L5.055 7.061Z" />
            </svg>
        </a>
    </nav>

    <main>
        <h1>
            7. Diffieâ€“Hellmanâ€“Merkle key exchange
        </h1>


        <p><i>I understood Diffieâ€“Hellman key exchange after
                watching <a class="underline-style" href="https://www.youtube.com/watch?v=85oMrKd8afY"
                    target="_blank">Brian
                    Yu's
                    video on YouTube</a>. This article is heavily inspired from his video. If you are a video person,
                then I will recommend you to watch that video and then move to the next lesson. Remember, do come back
                and continue from the next lesson :)</i></p>


        <p>This lesson contains lots of diagrams, you can click on any image to enlarge it for proper viewing
            experience.</p>

        <p>
            In the first lesson of symmetric key encryption, we told you about a story where the Greek emperor gave his
            army
            commander
            the <code>key</code> so that the army commander could decrypt emperor's encrypted messages.
        </p>

        <p>
            In those old times, the emperor was able to physically give the encryption <code>key</code> to the army
            commander.
            But with time as computer networking
            came along, communication between computers sitting seven oceans apart became a thing. Giving the encryption
            key physically was now not a solution.
        </p>

        <p>
            Now imagine, I live in India and I want to send a confidential message to my friend living in the US. How
            can I
            share the encryption <code>key</code>
            with my friend in the US so that I can send encrypted message to his computer via the internet?
        </p>


        <figure>
            <img data-zoomable src="key-intercept.png" alt="Eavesdropper intercepting the key">
            <figcaption>
                Eavesdropper intercepting the key.
            </figcaption>
        </figure>

        <p>If I generate an encryption key and send it to my friend in the US, an attacker (called eavesdropper)
            could read the data packets
            and
            will get to know my encryption key. Now when I send confidential messages to my friend, <strong>the
                eavesdropper will be
                able to decrypt my confidential messages because he has access to the encryption key.</strong></p>

        <p> This problem was a pain in the ass to deal with. There was no way one could send encrypted messages over the
            network
            <strong>because the eavesdropper was able to read the encryption key.</strong> We needed a way through which
            two people can
            share their
            encryption key without the eavesdropper being able to read the key.
        </p>

        <p> This was the problem that <strong>Diffie, Hellman and
                Merkle solved with their key exchange algorithm</strong>.</p>

        <p>The <strong>Diffieâ€“Hellmanâ€“Merkle key exchange also known as Diffieâ€“Hellman key exchange</strong> is a
            mathematical algorithm
            that allows
            two people to arrive at the same <strong>key</strong> without the eavesdropper getting access to that key.
        </p>

        <p>Once they have arrived at the same key, now they can use that <strong>key as their symmetric encryption
                key!</strong> </p>



        <h2>Intuition behind the Diffieâ€“Hellman key exchange</h2>


        <p>
            The Diffieâ€“Hellman key exchange algorithm was the first ever practical key exchange algorithm. It was one of
            the most fundamental
            discoveries in cryptography. And all of the Internet use Diffieâ€“Hellman key exchange to this date!
        </p>

        <p>
            Diffieâ€“Hellman key exchange is a four step process. Let us understand the intuition behind it with
            a <strong>flawed implementation.</strong>
        </p>

        <h3>Step 1: Generate initial</h3>

        <figure>
            <img data-zoomable src="flaw-step-1.png" alt="Generating a random initial and passing to mr bug">
            <figcaption>
                Step 1: Mr. Ant generates a random initial number and sends it to Mr. Bug.
            </figcaption>
        </figure>

        <p>We have two parties -- Mr. Ant and Mr. Bug.</p>

        <p>
            Mr. Ant generates a random number, we call this number the <code>initial</code> number. This initial
            number
            is passed to Mr. Bug over Internet. The eavesdropper sees this number and stores it in his computer.
        </p>

        <h3>Step 2: Both generate their private number</h3>

        <figure>
            <img data-zoomable src="flaw-step-2.png" alt="Both generate their private numbers">
            <figcaption>
                Step 2: Ant and Bug generate their private numbers.
            </figcaption>
        </figure>

        <p>Ant and Bug both generate a random number which they keep it with themselves, they don't share it. We call
            this number
            as the <code>private</code> number. Remember, this is not passed over Internet, <strong>they both keep this
                number
                private to
                themselves</strong>.
        </p>

        <p>Ant has generated <strong>10</strong> as his private number and Bug has generated <strong>19</strong> as his
            private number.</p>

        <h3>Step 3: Ant and Bug share with each other their public number</h3>

        <figure>
            <img data-zoomable src="flaw-step-3.png" alt="Ant and Bug do initial + private and passes to each other.">
            <figcaption>
                Step 3: Ant and Bug do initial + private and passes to each other.
            </figcaption>
        </figure>

        <p>
            Ant sums the initial and his private number. That is, <code>25 + 10 = 35</code>. And passes it to Bug. We
            call this
            <code>35</code> as a <strong>public number</strong> because this number is shared with the other party.
        </p>

        <p>Bug do the same. Bug sums the initial and his private number. That is, <code>25 + 19 = 44</code>. This get
            passed to Ant. Here, <code>44</code> is the <strong>public number.</strong></p>

        <p>Both the sums -- 35 and 44 are seen by the eavesdropper. He stores these as well in his computer.</p>

        <p>Now, comes the last step.</p>

        <h3>Step 4: arriving at the same secret key</h3>

        <figure>
            <img data-zoomable src="flaw-step-4.png" alt="private + received sum illustration.">
            <figcaption>
                Step 4: Ant and Bug do the final step -- private + received sum to arrive at the shared secret key.
            </figcaption>
        </figure>

        <p>Ant adds his private number to the value he received from Bug in the previous step, which will be
            <code>44 + 10 = 54</code>.
        </p>

        <p>Bug adds his private number to the sum he received from Ant, that comes out to be
            <code>35 + 19 = 54</code>.
        </p>

        <p>See, finally they <strong>both have arrived at the same number 54.</strong> They <strong>share</strong> a
            number that just <strong>they both know.</strong> Not the eavesdropper. Hence, this number <code>54</code>
            is called as a
            <strong>shared secret
                number.</strong> Or <strong>shared secret key.</strong> Sometimes simply referred to as just secret key.
        </p>

        <p>Now if Ant wants to send an encrypted message to Bug, he can encrypt it using the shared key that is
            54, and only Bug will be able to decrypt it because only Bug has access to that key not anyone else!</p>

        <p>Before you move forward, please make sure you understand these four steps intuitively. If it didn't click,
            then go through the four steps just once more and I'm sure it will click!</p>

        <h3>How do they arrive at the same shared key at the end?</h3>

        <p>This is a fundamental question! Let us understand how.</p>

        <figure>
            <img data-zoomable src="flaw-step-4.png" alt="private + received sum illustration.">
            <figcaption>
                Step 4: Ant and Bug do the final step -- private + received sum to arrive at the shared secret key.
            </figcaption>
        </figure>

        <p>
            If you look at the step 4 image above. You will see that Ant is doing:
            <code>44 + Ant's private [10]</code> to arrive at the shared secret key 54.
        </p>

        <p><code>=> 44 + Ant's private [10]</code></p>


        <figure>
            <img data-zoomable src="flaw-step-3.png" alt="Ant and Bug do initial + private and passes to each other.">
            <figcaption>
                Step 3: Ant and Bug do initial + private and passes to each other.
            </figcaption>
        </figure>


        <p>
            Now look at the step 3 image above. Ant received 44 from Bug in step 3. Bug calculated 44 by doing:
            <code>initial [25] + Bug's private [19]</code>.
        </p>

        <p>So on the <strong>Ant's side</strong>, we can expand 44 as:
            <code>initial [25] + Bug's private [19]</code>. Putting it together:
        </p>

        <code>=> <span style="background-color: orange;">44</span> + Ant's private [10]</code>
        <br>
        <strong><code>=> <span style="background-color: orange;">(initial [25] + Bug's private [19])</span> + Ant's private [10]</code></strong>
        <br>
        <br>
        <br>

        <p>Now, similarly on the <strong>Bug's side</strong> we can expand 35 as:
            <code>(initial [25] + Ant's private [10])</code>:
        </p>

        <code>=> <span style="background-color: orange;">35</span> + Bug's private [19]</code>
        <br>
        <strong><code>=> <span style="background-color: orange;">(initial [25] + Ant's private [10])</span> + Bug's private [19]</code></strong>

        <p>If you look at the above two equations that we ended up with, you will see that we are actually doing the
            same calculation in both the equations, just the order in which we are adding secrets is different. And in
            addition order of adding numbers doesn't matter.</p>

        <p>If you do <code>3 + 2 + 1</code> OR you do <code>1 + 2 + 3</code>, result will be the same.</p>

        <p><strong>That's the reason behind how we arrived at the same key at the end. Isn't this a simple concept used
                in an
                astonishingly smart way?</strong></p>

        <h2>But there's a major flaw!</h2>

        <p>There's a <strong>major flaw</strong> in the above algorithm we discussed. Let us uncover it. It will help us
            understand the real Diffieâ€“Hellman algorithm.</p>

        <p>Remember, in the first lesson, we told you about the Kerckhoffs' principle. According to Kerckhoffs'
            principle, it should be assumed that the cryptographic algorithm is known to everyone. A secure
            cryptographic algorithm is
            the one which remains secure even if everybody knows about its implementation.</p>

        <p>So, the eavesdropper knows about the implementation we talked above. Let us see what happens next.</p>

        <figure>
            <img data-zoomable src="flaw-step-3.png" alt="Ant and Bug do initial + private and passes to each other.">
            <figcaption>
                <strong>Step 3:</strong> Ant and Bug do initial + private and passes to each other.
            </figcaption>
        </figure>

        <p>
            Look at the step three image above. Ant is sending <code>initial [25] + private [10] = 35</code> to Bug.
        </p>

        <p>Eavesdropper reads 35 as it was passed to Bug via Internet. Eavesdropper already has seen
            <code>initial</code>.
            According to Kerckhoffs' principle, eavesdropper knows the formula:
        </p>

        <code>initial [25] + private [10] = 35</code>

        <p>Now, eavesdropper has <code>35 and initial [25]</code>. Can he find the private number? Ofcourse, he can
            easily find Ant's private number by subtracting:
            <code>35 - initial [25] = private [10]</code>.
        </p>

        <p> <strong>Ant's private number is revealed to the eavesdropper! This compromises the whole security of our key
                exchange algorithm.</strong></p>

        <figure style="margin-top: 60px;">
            <img data-zoomable src="flaw-step-4.png" alt="private + received sum illustration.">
            <figcaption>
                <strong>Step 4:</strong> Ant and Bug do the final step -- private number + received sum to arrive at the
                shared
                secret key.
            </figcaption>
        </figure>

        <p>Look at the step four image above, if the eavesdropper has figured out Ant's private number and eavesdropper
            is already aware
            of
            44, he can simply sum them and <strong>he will get to know the shared secret 54!</strong>
        </p>

        <p>With the eavesdropper having access to the shared secret 54, he will be able to decrypt the messages and read
            them. And all sorts of bad things can happen!</p>

        <h2>The real Diffieâ€“Hellman key exchange</h2>


        <p>The problem with the above implementation was that --</p>

        <p>Look at this formula: <code>initial [25] + private [10] = 35</code>. The eavesdropper had access to <code>35 and
            initial [25]</code>. So he could simply subtract and find the private number. Addition can easily be
            reversed by
            subtraction. Same with multiplication, easily reversed with division.</p>

        <p>If we can find a way via which its extremely hard to reverse the operation when the attacker has access to
            all the values of the equation <strong>except the private number</strong> then we can create a secure key
            exchange.</p>

        <p>Diffie and Hellman solved this using <strong>modular exponentiation</strong>:
            <code>x<sup>y</sup> mod z = result</code>.
        </p>

        <figure>
            <img data-zoomable src="mod-notation-explain.png" alt="Terminology.">
            <figcaption>
                Terminology.
            </figcaption>
        </figure>

        <p>But what does <code>mod</code> do?</p>

        <p>Suppose we are doing <code>10 mod 3</code>. The result will be the remainder when 10 is divided by 3. When we
            divide 10 by 3, we get 1 as the remainder, right? So, 1 will be result of <code>10 mod 3</code>.
        </p>

        <p>In programming languages, <code>%</code> (percent sign) is the modulo operator. If you type
            <code>10 % 3</code> in your DevTools console, you will get <code>1</code> as the output.
        </p>

        <p>Now we have understood <code>mod</code>. Let us look at <strong>modular exponentiation.</strong></p>

        <p>For example let us take: <code>3<sup>6</sup> mod 520 = 209</code>. We have 3 to the power 6, when there's
            power
            or also called exponent in the mod equation, that equation then comes in the category of modular
            exponentiation.</p>

        <p>This is fascinating because even if the eavesdropper knows about: 3, 520 and 209 in our equation
            <code>3<sup>?</sup> mod 520 = 209</code>. It's hard for him to find the correct exponent that is 6. Why?
        </p>

        <p>Because he will need to <strong>brute-force the exponent</strong>, he will first try 1 then 2 then 3... and
            so on. There's no easy way to find the exponent.</p>

        <p>The <strong>modulus and exponent</strong> are always very large numbers (more than 600 digits long) and they
            are chosen with such mathematical properties
            that it becomes
            computationally
            infeasible for an attacker
            to compute the exponent.</p>

        <p>That's why, Diffie and Hellman made the <strong>exponent as the private
                number</strong>. Even if the eavesdropper knows about the <code>base</code>, <code>modulus</code> and
            <code>result</code>, its going to be
            practically infeasible for the eavesdropper to find the <code>exponent</code> which is going to be the
            <code>private numbers</code> of Ant and Bug.
        </p>

        <p>For our learning purposes, we will be using very small numbers. But you know it's not like this in the real
            world ;)</p>

        <p>In the actual Diffieâ€“Hellman key exchange, the intuition will remain the same as the flawed one. In the
            actual algorithm, instead of playing
            with addition, we will be playing with modular exponentiation.</p>

        <h2>The real Diffieâ€“Hellman key exchange</h2>

        <h3>Step 1: Ant and Bug agrees on base and modulus</h3>

        <figure>
            <img data-zoomable src="real-step-1.png" alt="Step 1: Ant and Bug agrees on base and modulus.">
            <figcaption>
                Step 1: Ant and Bug agrees on base and modulus.
            </figcaption>
        </figure>

        <p>Ant and Bug talk to each other via the Internet and they both agree on the same <code>base</code> and
            <code>modulus</code>. Eavesdropper sees these values.
        </p>

        <h3>Step 2: Both generate their private number</h3>

        <figure>
            <img data-zoomable src="real-step-2.png" alt="Step 2: Ant and Bug generate their private number.">
            <figcaption>
                Step 2: Ant and Bug generate their private number.
            </figcaption>
        </figure>

        <p>
            Ant and Bug generate their respective private numbers. Eavesdropper can't see these private numbers.
        </p>

        <h3>Step 3: Ant and Bug share with each other their public number</h3>

        <figure>
            <img data-zoomable src="real-step-3.png" alt="Step 3: Doing modular exponentiation and sending it.">
            <figcaption>
                Step 3: Doing modular exponentiation and sending it.
            </figcaption>
        </figure>

        <p>
            Ant calculates <strong><code>(base<sup>ant's private number</sup> mod modulus)</code></strong>. It comes out
            to be:
            <strong><code>2<sup>8</sup> mod 19 = 9</code></strong>. The result 9 (public number) gets sent to Bug.
        </p>

        <p>
            Similarly, Bug calculates <strong><code>(base<sup>bug's private number</sup> mod modulus)</code></strong>.
            It equals
            to <strong><code>2<sup>15</sup> mod 19 = 12</code></strong> and then Bug sends 12 (public number) to Ant.
        </p>


        <h3>Step 4: arriving at the shared secret key</h3>

        <figure>
            <img data-zoomable src="real-step-4.png" alt="Step 4: Received value's modular exponentiation.">
            <figcaption>
                Step 4: Received value's modular exponentiation.
            </figcaption>
        </figure>

        <p>Ant in the previous step received 12 from Bug. In this last step, the received 12 becomes the base:
            <code>(Base<sup>Ant's private number</sup> mod modulus)</code>, it equates to:
            <code>12<sup>8</sup> mod 19 = 11</code>.
        </p>

        <p>Similarly, Bug uses 9 as the base that he received from Ant in the previous step. His calculation comes out
            to be: <code>9<sup>15</sup> mod 19 = 11</code>.
        </p>

        <p><strong>They both have finally arrived at the same number that is their shared secret key! ðŸ™Œ</strong></p>


        <h3>How does this work?</h3>

        <p>The intuition is exact same as we saw in our flawed implementation. So, this time I will go a bit fast with
            the explanation. I will expect from you to scroll up to look at the step 3 image and step 4 image as you
            read the explanation.</p>

        <p><strong>On the Ant's side</strong>, we had <code>12<sup>8</sup> mod 19 = 11</code> as the final equation in
            the step 4:</p>

        <code>=> <span style="background-color: orange;">12</span><sup>8</sup> mod 19</code>
        <p>Now let us expand 12 that we received from Bug in the step 3.</p>
        <strong><code>=> <span style="background-color: orange;">(2<sup>15</sup> mod 19)</span><sup>8</sup> mod 19</code></strong>

        <p><strong>On the Bug's side</strong>, we had <code>9<sup>15</sup> mod 19 = 11</code> as the final equation in
            the step 4:</p>

        <code>=> <span style="background-color: orange;">9</span><sup>15</sup> mod 19</code>
        <p>Now let us expand 9 that we received from Ant in the step 3.</p>
        <strong><code>=> <span style="background-color: orange;">(2<sup>8</sup> mod 19)</span><sup>15</sup> mod 19</code></strong>

        <p>Both the equations are essentially the same equation when modular arithmetic properties are applied.</p>

        <code>=> <u>Equation 1</u>: (2<sup>15</sup> mod 19)<sup>8</sup> mod 19</code>
        <br>
        <code>=> <u>Equation 2</u>: (2<sup>8</sup> mod 19)<sup>15</sup> mod 19</code>
        <br>

        <p>According to modular arithmetic properties: </p>

        <code>(base<sup>a</sup> mod n)<sup>b</sup> mod n = (base<sup>a*b</sup> mod n)</code>
        <br>

        <p>Now, let us apply the above property to both the equations.</p>

        <code>=> <u>Equation 1</u>: (2<sup>15</sup> mod 19)<sup>8</sup> mod 19 =  (2<sup>15*8</sup> mod 19)</code>
        <br>
        <code>=> <u>Equation 2</u>: (2<sup>8</sup> mod 19)<sup>15</sup> mod 19 = (2<sup>8*15</sup> mod 19)</code>
        <br>

        <p>See, both the equations are exact same! This is how they both arrive at the same secret key without
            the eavesdropper ever knowing about it.</p>

        <p>As we already know, this shared secret key can be used as an encryption key to prevent eavesdropper from
            making sense of the messages.</p>

        <p>That's the power of the Diffieâ€“Hellman key exchange guys!</p>

        <hr>

        <div id="quiz" style="margin-top: 80px;">

            <h3 style="text-align: center;">Understanding Check</h3>

            <p style="margin-bottom: 0;"><strong><u>Question</u></strong></p>
            <p style="margin-top: 0;">
                In step 3 of the Diffieâ€“Hellman, Mr. Ant calculated: <code>(2<sup>8</sup> mod 19 = 9)</code> and
                sent 9 (public number) to Bug.
                <br>
                <br>
                Now,
                The eavesdropper has access to the <code>base [2], modulus [19] and the result [9]</code>. Why is it
                hard for
                the eavesdropper to find out the exponent 8 which is the Ant's private number?
            </p>

            <div class="option" style="font-size: smaller;" data-correct="false">Because in the real world, exponent
                will
                be a very large number
            </div>
            <div class="option" style="font-size: smaller;" data-correct="false">Because in the real world, modulus will
                be a very large number</div>
            <div class="option" style="font-size: smaller;" data-correct="true">Because in the real world, modulus and
                exponent both will be
                very large numbers so the eavesdropper will
                need to brute-force the exponent which will be practically infeasible</div>
            <div class="option" style="font-size: smaller;" data-correct="false">The <code>mod</code> makes it
                infeasible
            </div>

            <div id="result"></div>
        </div>

        <script>
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function () {
                    const resultDiv = document.getElementById('result');

                    // Clear previous results
                    resultDiv.innerHTML = '';

                    // Grey out all options immediately
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.classList.add('in-progress');
                        opt.style.pointerEvents = 'none';
                    });

                    // Show progress indicator
                    const progressIndicator = document.createElement('div');
                    progressIndicator.className = 'progress';
                    resultDiv.appendChild(progressIndicator);

                    // Simulate processing with a delay
                    setTimeout(() => {
                        // Remove progress indicator
                        resultDiv.innerHTML = '';

                        // Remove grey out
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('in-progress');
                            opt.style.pointerEvents = 'auto';
                        });

                        // Show result
                        if (this.getAttribute('data-correct') === 'true') {
                            resultDiv.textContent = "That's the correct answer! ðŸŽ‰";
                            resultDiv.style.color = "green";
                        } else {
                            resultDiv.textContent = "ðŸš¨ It's incorrect! Please try again.";
                            resultDiv.style.color = "red";
                        }
                    }, (Math.random() * 1000) + 100); // random small delay
                });
            });
        </script>

        <h2>Credits / More resources</h2>

        <p>Below are some resources I used to tighten my understanding. You <strong>don't</strong> need to consume
            these. If you
            have read this article or watched Brian's video, you already understand this topic well enough.</p>

        <ul>
            <li> <a target="_blank" class="underline-style" href="https://www.youtube.com/watch?v=YEBfamv-_do">Art of
                    the Problem's YT video</a>.</li>
            <li><a target="_blank" class="underline-style"
                    href="https://www.youtube.com/watch?v=vsXMMT2CqqE">Computerphile video</a>.</li>
            <li><a target="_blank" class="underline-style" href="https://www.youtube.com/watch?v=Yjrfm_oRO0w">Again, a
                    computerphile video</a>.</li>
            <li><a target="_blank" class="underline-style"
                    href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">The old gold, Wikipedia
                    article</a>.</li>
        </ul>

        <a href="../8-rsa" class="btn primary-btn">
            Go to next lesson: RSA
        </a>

        <hr class="before-footer-hr">

        <p class="footer">
            I have worked hard to create this course. If you are getting some learnings from it, you should follow me on
            Twitter: <a href="https://x.com/vkwebdev" class="underline-style"
                target="_blank"><span>twitter.com/vkwebdev</span></a>. I try to be useful there :)
        </p>
    </main>
</body>

</html>
